<html>
<title>Ultimate Pong</title>
<canvas id="canvas" width="600px" height="400px" style="border: 1px solid #000000"></canvas>
<script src='https://cdn.socket.io/socket.io-1.4.5.js'></script>
<script>
    var canvas = document.getElementById('canvas');
    var ctx = document.getElementById('canvas').getContext('2d');
    ctx.translate(canvas.width/2,canvas.height/2);
    var socket = io();

    // New position data is sent
    socket.on('newPositions',function(data){
        ctx.clearRect(-canvas.width/2, -canvas.height/2, canvas.width, canvas.height);
        // console.log(data);
        for(var i = 0; i < data.length-1; i++){
            drawPaddle(data[i]);
        }
        drawBall(data[data.length-1]);
    });

    // Score data is sent
    socket.on('scoresUpdated',function(data){
        document.getElementById("scoreContainer").innerHTML = "<h1>Scores</h1><br>";
        for (var i = 0; i < data.length; i++)
        {
            console.log(data[i].score);
            var html = '<h3>Player '+(i+1)+': '+data[i].score+'</h3><br>';
            document.getElementById("scoreContainer").innerHTML += html;
        }
    });

    // Controls
    document.onkeydown = function(e){
        if(e.keyCode === 68){ //d
            socket.emit('keyPress',{inputId: 'right', state:true});
        }else if(e.keyCode === 65){ //a
            socket.emit('keyPress',{inputId: 'left', state:true});
        }
    }
    document.onkeyup = function(e){
        if(e.keyCode === 68){ //d
            socket.emit('keyPress',{inputId: 'right', state:false});
        }else if(e.keyCode === 65){ //a
            socket.emit('keyPress',{inputId: 'left', state:false});
        }
    }

    // Helps render paddles
    function lineToAngle(ctx, x1, y1, length, angle) {
        angle *= Math.PI / 180;
    
        var x2 = x1 + length * Math.cos(angle),
            y2 = y1 + length * Math.sin(angle);
    
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
    
        return {x: x2, y: y2};
    }

    // Renders ball
    function drawBall(ballInfo) 
    {
        ctx.beginPath();
        ctx.arc(ballInfo.x, ballInfo.y, ballInfo.radius, 0, Math.PI*2);
        ctx.fillStyle = "#0095DD";
        ctx.fill();
        ctx.closePath();
    }

    // Renders paddles
    function drawPaddle(paddleInfo)
    {
        ctx.beginPath();
        ctx.fillStyle = paddleInfo.randomColor;
        newX = Math.cos(paddleInfo.degrees * Math.PI / 180)*paddleInfo.currentOffset + paddleInfo.startingXPos;
        newY = Math.sin(paddleInfo.degrees * Math.PI / 180)*paddleInfo.currentOffset + paddleInfo.startingYPos;
        lineToAngle(ctx, newX, newY, paddleInfo.paddleWidth, paddleInfo.degrees); // problem child, check original
        ctx.lineWidth = 10;
        ctx.stroke();
    }
</script>
<body>
    <br>
    <div id="scoreContainer">
        <h1>Scores</h1><br>
    </div>
</body>
</html>